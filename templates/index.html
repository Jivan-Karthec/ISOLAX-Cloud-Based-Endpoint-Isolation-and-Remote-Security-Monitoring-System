{{define "index.html"}}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Isolax EDR ‚Ä¢ Security Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .glass-card {
      background: radial-gradient(circle at top left, rgba(34,211,238,0.14), transparent 60%),
                  rgba(15,23,42,0.96);
      backdrop-filter: blur(22px);
    }
    .grid-bg {
      background-image:
        linear-gradient(to right, rgba(30,64,175,0.25) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(30,64,175,0.2) 1px, transparent 1px);
      background-size: 42px 42px;
      opacity: 0.2;
      pointer-events: none;
    }
  </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">
<div class="fixed inset-0 grid-bg"></div>

<div class="relative flex min-h-screen">
  <!-- SIDEBAR -->
  <aside class="w-64 bg-slate-950/90 border-r border-slate-800 flex flex-col">
    <div class="px-6 py-5 border-b border-slate-800">
      <div class="flex items-center gap-2">
        <div class="w-8 h-8 rounded-xl bg-cyan-500/10 border border-cyan-400/40 flex items-center justify-center">
          <div class="w-3 h-3 rounded-full bg-cyan-400 shadow-[0_0_16px_rgba(34,211,238,0.8)]"></div>
        </div>
        <div>
          <div class="text-lg font-semibold tracking-wide">
            <span class="text-cyan-400">Isolax</span> EDR
          </div>
          <div class="text-[11px] uppercase text-slate-500 tracking-[0.18em]">
            Cyber Defense Console
          </div>
        </div>
      </div>
    </div>

    <nav class="flex-1 px-4 py-4 text-sm space-y-1">
      <div class="text-[11px] uppercase text-slate-500 mb-2 tracking-[0.14em]">Navigation</div>

      <a href="/"
         class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-900 text-cyan-300 border border-cyan-500/40">
        <span class="w-1.5 h-1.5 rounded-full bg-emerald-400"></span>
        Dashboard
      </a>
    </nav>

    <div class="px-5 py-4 border-t border-slate-800 text-[11px] text-slate-500 space-y-1">
      <div>Devices: <span class="text-cyan-300 font-medium">{{len .}}</span></div>
      <a href="/logout" class="inline-block mt-1 text-red-400 hover:text-red-300">Logout</a>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="flex-1 flex flex-col">
    <!-- TOP BAR -->
    <header class="h-16 border-b border-slate-800 flex items-center justify-between px-6 bg-slate-950/80 backdrop-blur">
      <div>
        <div class="text-xs text-slate-400">Overview</div>
        <div class="text-lg font-semibold flex items-center gap-2">
          Security Dashboard
          <span class="text-[11px] px-2 py-0.5 rounded-full border border-slate-700 text-slate-400">
            Isolation build
          </span>
        </div>
      </div>

      <div class="flex items-center gap-3 text-xs">
        <button onclick="location.reload()"
                class="px-3 py-1.5 rounded-lg bg-slate-900 border border-slate-700 hover:border-cyan-400 hover:bg-slate-900/80 text-slate-100 text-xs flex items-center gap-1">
          <span class="w-1.5 h-1.5 rounded-full bg-cyan-400"></span>
          Refresh
        </button>
      </div>
    </header>

    <!-- CONTENT -->
    <section class="flex-1 p-6 space-y-6 overflow-y-auto">

      <!-- STAT CARDS -->
      <div class="grid grid-cols-1 sm:grid-cols-3 xl:grid-cols-4 gap-4">
        <div class="glass-card border border-slate-800 rounded-2xl p-4 shadow-[0_0_25px_rgba(15,23,42,0.9)]">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-[11px] text-slate-400 mb-1 uppercase tracking-[0.15em]">Total Devices</div>
              <div class="text-2xl font-semibold">{{len .}}</div>
            </div>
          </div>
        </div>

        <div class="glass-card border border-slate-800 rounded-2xl p-4">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-[11px] text-slate-400 mb-1 uppercase tracking-[0.15em]">Online</div>
              <div id="onlineCount" class="text-2xl font-semibold">0</div>
            </div>
          </div>
        </div>

        <div class="glass-card border border-slate-800 rounded-2xl p-4">
          <div class="text-[11px] text-slate-400 mb-1 uppercase tracking-[0.15em]">Isolation Mode</div>
          <div class="text-2xl font-semibold text-amber-300">Isolax Isolation</div>
        </div>

        <div class="glass-card border border-slate-800 rounded-2xl p-4">
          <div class="text-[11px] text-slate-400 mb-1 uppercase tracking-[0.15em]">Build</div>
          <div class="text-2xl font-semibold text-cyan-300">Isolax</div>
        </div>
      </div>

      <!-- DEVICE LIST -->
      <div id="devicesSection" class="glass-card border border-slate-800 rounded-2xl p-4">
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-4">
          <div>
            <div class="text-sm font-semibold">Devices</div>
            <div class="text-[11px] text-slate-400">
              Connected endpoints monitored by Isolax
            </div>
          </div>

          <div class="flex flex-wrap gap-2 items-center">
            <div class="relative">
              <input id="searchBox" type="text"
                     placeholder="Search client ID..."
                     class="pl-7 pr-2 py-1.5 rounded-lg bg-slate-900 border border-slate-700 text-xs focus:outline-none focus:ring-1 focus:ring-cyan-400 text-slate-100">
              <span class="absolute left-2 top-1.5 text-slate-500 text-xs">üîé</span>
            </div>
          </div>
        </div>

        <div class="overflow-x-auto text-xs">
          <table class="min-w-full border-separate border-spacing-y-1">
            <thead class="text-slate-400">
            <tr>
              <th class="text-left px-3 py-1.5">Client ID</th>
              <th class="text-left px-3 py-1.5">OS</th>
              <th class="text-left px-3 py-1.5">Version</th>
              <th class="text-left px-3 py-1.5">Status</th>
              <th class="text-left px-3 py-1.5">Isolation</th>
              <th class="text-left px-3 py-1.5">Actions</th>
            </tr>
            </thead>
            <tbody id="deviceTableBody">
            {{range .}}
              <tr class="bg-slate-950/70 hover:bg-slate-900/80 transition-colors device-row">
                <td class="px-3 py-1.5 text-sm client-id">{{.ID}}</td>
                <td class="px-3 py-1.5 text-[11px] text-slate-300">{{.OS}}</td>
                <td class="px-3 py-1.5 text-[11px] text-slate-500">{{.Version}}</td>
                <td class="px-3 py-1.5">
                  {{if eq .Status "online"}}
                    <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-500/10 text-emerald-300 border border-emerald-400/30 text-[11px]">
                      <span class="w-1.5 h-1.5 rounded-full bg-emerald-400"></span> Online
                    </span>
                  {{else}}
                    <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-slate-700/40 text-slate-400 border border-slate-600/60 text-[11px]">
                      <span class="w-1.5 h-1.5 rounded-full bg-slate-500"></span> Offline
                    </span>
                  {{end}}
                </td>
                <td class="px-3 py-1.5">
                  {{if eq .Isolation "Isolated"}}
                    <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-red-500/10 text-red-300 border border-red-500/40 text-[11px]">
                      ‚óè Isolated
                    </span>
                  {{else}}
                    <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-500/10 text-emerald-300 border border-emerald-500/40 text-[11px]">
                      ‚óè Normal
                    </span>
                  {{end}}
                </td>
                <td class="px-3 py-1.5 space-x-1">
                  <a href="/viewer?client={{.ID}}"
                     class="px-3 py-1 rounded-lg bg-cyan-500 text-slate-950 text-[11px] font-medium">
                    Open
                  </a>
                </td>
              </tr>
            {{end}}
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
  (function () {
    const rows = document.querySelectorAll('#deviceTableBody tr');
    let online = 0;
    rows.forEach(r => {
      if (r.textContent.includes('Online')) online++;
    });
    const span = document.getElementById('onlineCount');
    if (span) span.textContent = online;
  })();

  (function () {
    const search = document.getElementById('searchBox');
    const rows = document.querySelectorAll('.device-row');
    if (!search) return;

    search.addEventListener('input', function () {
      const q = this.value.toLowerCase();
      rows.forEach(row => {
        const idCell = row.querySelector('.client-id');
        const idText = idCell ? idCell.textContent.toLowerCase() : "";
        row.style.display = idText.includes(q) ? '' : 'none';
      });
    });
  })();
</script>

</body>
</html>
{{end}}
